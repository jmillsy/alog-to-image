# ALOG to Image Renderer

[![Render ALOG Files](https://github.com/YOUR_USERNAME/alog-to-image/actions/workflows/render.yml/badge.svg)](https://github.com/YOUR_USERNAME/alog-to-image/actions/workflows/render.yml)

Convert Artisan roaster `.alog` files into beautiful PNG visualizations showing temperature curves and rate of rise (RoR).

## Features

- üìä Renders Bean Temperature (BT) and Environment Temperature (ET) curves
- üìà Calculates and displays Rate of Rise (RoR) 
- üéØ Shows roast phases: DRY END, First Crack Start (FCs), First Crack End (FCe), DROP
- üìù Includes roast metadata: beans, roaster type, weight loss
- ü§ñ Automated rendering via GitHub Actions
- üé® High-quality output with customizable DPI

## Installation

```bash
# Clone the repository
git clone <your-repo-url>
cd alog-to-image

# Install dependencies
pip install -r requirements.txt
```

## CLI Usage

### Basic Usage

Render an alog file to PNG (output will be named same as input with .png extension):

```bash
python alog_renderer.py example/#28_25-11-28_1654.alog
```

### Specify Output Path

```bash
python alog_renderer.py input.alog -o output/my_roast.png
```

### Custom DPI

```bash
python alog_renderer.py input.alog --dpi 300
```

### Update Roast Log

Manually update the roast log with a new entry:

```bash
python update_roast_log.py input.alog renders/#28.png
```

### Full Options

```bash
python alog_renderer.py --help
```

Output:
```
usage: alog_renderer.py [-h] [-o OUTPUT] [--dpi DPI] input

Render Artisan roaster .alog files to PNG images

positional arguments:
  input                 Path to the input .alog file

options:
  -h, --help            show this help message and exit
  -o OUTPUT, --output OUTPUT
                        Path for the output PNG file (default: input_name.png)
  --dpi DPI             DPI for output image (default: 150)
```

## Using in Your Own Repository

This tool is designed to be used in your personal roast log repository. Here's how to set it up:

### 1. Copy the Workflow

Copy `.github/workflows/render.yml` to your roast repository's `.github/workflows/` folder.

### 2. Copy the Scripts

Copy these files to your roast repository:
- `alog_renderer.py`
- `update_roast_log.py`
- `requirements.txt`

### 3. Initialize Your Roast Log

Create an empty `ROASTS.md` file in your repository:

```markdown
# Roast Log

A chronological log of all coffee roasts.

```

### 4. Add Your First Roast

1. Add your `.alog` file to the repository
2. Commit and push to GitHub
3. The workflow will automatically:
   - Render the profile to `renders/#<batch>.png`
   - Extract metadata and append to `ROASTS.md`
   - Commit the changes back to your repository

### Workflow Behavior

- **On push**: Only processes new or modified `.alog` files
- **Manual trigger**: Processes all `.alog` files in the repository
- **Auto-commits**: Uses `[skip ci]` to prevent infinite loops
- **Duplicate protection**: Skips roasts already in `ROASTS.md`

### Example Roast Log Output

Your `ROASTS.md` will look like this:

```markdown
# Roast Log

A chronological log of all coffee roasts.

| Roast | Date | Time | Dev % | Profile |
|-------|------|------|-------|----------|
| #28 | Fri Nov 28 2025 | 10.1 min | 11.3% | ![Profile](renders/#28.png) |
| #27 | Thu Nov 27 2025 | 9.5 min | 12.1% | ![Profile](renders/#27.png) |
```

Roasts are sorted newest first (descending by date).

## About ALOG Files

ALOG files are generated by [Artisan](https://artisan-scope.org/), an open-source software for coffee roasters. The files are Python dictionaries containing:

- Time series data (`timex`, `temp1`, `temp2`)
- Roast metadata (beans, roaster, dates, weights)
- Event markers (CHARGE, TP, DRY, FCs, FCe, DROP)
- Extra sensor data (exhaust temp, ambient temp)

## How It Works

1. **Parse**: Uses `ast.literal_eval()` to safely parse the Python dictionary
2. **Extract**: Pulls time series data for temperatures (BT, ET)
3. **Calculate**: Computes Rate of Rise using a 30-second rolling window
4. **Visualize**: Creates dual-panel plot with matplotlib
5. **Save**: Exports to PNG with metadata overlay

## Example Output

The rendered image includes:
- Upper panel: Temperature curves (BT in blue, ET in red)
- Lower panel: Rate of Rise curve (green)
- Vertical markers for roast phases (DRY, FCs, FCe, DROP)
- Metadata box with beans, roaster, and weight information

## Requirements

- Python 3.7+
- matplotlib >= 3.5.0

## License

MIT License - feel free to use and modify as needed.

## Contributing

Contributions welcome! Some ideas:

- Add support for different temperature units (Celsius)
- Include additional sensor data visualization
- Add RoR for ET curve
- Export to other formats (SVG, PDF)
- Interactive plots with plotly

## Troubleshooting

### "Error parsing alog file"

Make sure your `.alog` file is a valid Python dictionary. You can test by running:

```python
import ast
with open('your_file.alog', 'r') as f:
    data = ast.literal_eval(f.read())
```

### "No valid temperature data found"

Check that your alog file contains `timex`, `temp1`, and `temp2` keys with valid data (not all `-1.0` values).

### GitHub Actions not running

Ensure the workflow file is in `.github/workflows/render.yml` and you've committed/pushed it to your repository.
